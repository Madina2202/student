"use strict";
import { jsx, jsxs } from "react/jsx-runtime";
import { useEffect, useState } from "react";
import { Button, Form, Input, message, Modal, Popconfirm, Space, Table } from "antd";
import { request } from "@umijs/max";
const Group = () => {
  return /* @__PURE__ */ jsx("div", { children: /* @__PURE__ */ jsx("h1", { children: "Group Page" }) });
};
export default function GroupPage() {
  const [dataSource, setDataSource] = useState([]);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [form] = Form.useForm();
  const loadGroups = () => {
    request("/api/Group/GetAll", { method: "GET" }).then((result) => setDataSource(result)).catch(() => message.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0433\u0440\u0443\u043F\u043F"));
  };
  useEffect(() => {
    loadGroups();
  }, []);
  const onFinish = (values) => {
    if (values.id) {
      request("/api/Group/Post", {
        method: "POST",
        data: values
      }).then(() => {
        message.success("\u0413\u0440\u0443\u043F\u043F\u0430 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0430");
        setIsModalOpen(false);
        loadGroups();
      }).catch(() => message.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u0433\u0440\u0443\u043F\u043F\u044B"));
    } else {
      request("/api/Group/Add", {
        method: "PUT",
        data: { name: values.name }
      }).then(() => {
        message.success("\u0413\u0440\u0443\u043F\u043F\u0430 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0430");
        setIsModalOpen(false);
        loadGroups();
      }).catch(() => message.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u0438 \u0433\u0440\u0443\u043F\u043F\u044B"));
    }
  };
  const onRemove = (id) => {
    request(`/api/Group/Delete?id=${id}`, { method: "DELETE" }).then(() => {
      message.success("\u0413\u0440\u0443\u043F\u043F\u0430 \u0443\u0434\u0430\u043B\u0435\u043D\u0430");
      loadGroups();
    }).catch(() => message.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0438 \u0433\u0440\u0443\u043F\u043F\u044B"));
  };
  const onEdit = (record) => {
    form.setFieldsValue(record);
    setIsModalOpen(true);
  };
  const onAdd = () => {
    form.resetFields();
    setIsModalOpen(true);
  };
  const columns = [
    { title: "Id", dataIndex: "id" },
    { title: "\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435", dataIndex: "name" },
    {
      title: "\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044F",
      render: (_, record) => /* @__PURE__ */ jsxs(Space, { children: [
        /* @__PURE__ */ jsx(Button, { type: "link", onClick: () => onEdit(record), children: "\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C" }),
        /* @__PURE__ */ jsx(Popconfirm, { title: "\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0433\u0440\u0443\u043F\u043F\u0443?", okText: "\u0414\u0430", cancelText: "\u041D\u0435\u0442", onConfirm: () => onRemove(record.id), children: /* @__PURE__ */ jsx(Button, { type: "link", danger: true, children: "\u0423\u0434\u0430\u043B\u0438\u0442\u044C" }) })
      ] })
    }
  ];
  return /* @__PURE__ */ jsxs("div", { children: [
    /* @__PURE__ */ jsx(Button, { type: "primary", style: { marginBottom: 16 }, onClick: onAdd, children: "\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0433\u0440\u0443\u043F\u043F\u0443" }),
    /* @__PURE__ */ jsx(Table, { rowKey: "id", columns, dataSource }),
    /* @__PURE__ */ jsx(
      Modal,
      {
        title: "\u0413\u0440\u0443\u043F\u043F\u0430",
        open: isModalOpen,
        onCancel: () => setIsModalOpen(false),
        footer: null,
        destroyOnClose: true,
        children: /* @__PURE__ */ jsxs(Form, { form, onFinish, layout: "vertical", children: [
          /* @__PURE__ */ jsx(Form.Item, { name: "id", hidden: true, children: /* @__PURE__ */ jsx(Input, {}) }),
          /* @__PURE__ */ jsx(
            Form.Item,
            {
              label: "\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",
              name: "name",
              rules: [{ required: true, message: "\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0433\u0440\u0443\u043F\u043F\u044B" }],
              children: /* @__PURE__ */ jsx(Input, { placeholder: "\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0433\u0440\u0443\u043F\u043F\u044B" })
            }
          ),
          /* @__PURE__ */ jsx(Form.Item, { children: /* @__PURE__ */ jsx(Button, { type: "primary", htmlType: "submit", block: true, children: "\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C" }) })
        ] })
      }
    )
  ] });
}
